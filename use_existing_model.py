"""
–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø–æ–∫–∞–∑–∞ —Ä–∞–±–æ—Ç—ã –º–æ–¥–µ–ª–∏ Code Assistant
"""

from model_utils import CodeGenerator

def demonstrate_model():
    """–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã –º–æ–¥–µ–ª–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–¥–∞"""
    
    print("=" * 60)
    print("–ö–û–î-–ê–°–°–ò–°–¢–ï–ù–¢: –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã –º–æ–¥–µ–ª–∏")
    print("=" * 60)
    
    # –°–æ–∑–¥–∞–µ–º –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å –æ–±—É—á–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª—å—é
    print("\nüì¶ –ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—É—á–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏...")
    generator = CodeGenerator('model.pt')
    
    # –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
    examples = [
        {
            "id": 1,
            "description": "–Ω–∞–ø–∏—à–∏ —Ñ—É–Ω–∫—Ü–∏—é —Å–ª–æ–∂–µ–Ω–∏—è –¥–≤—É—Ö —á–∏—Å–µ–ª –Ω–∞ Python",
            "expected": "–§—É–Ω–∫—Ü–∏—è —Å–ª–æ–∂–µ–Ω–∏—è —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π"
        },
        {
            "id": 2,
            "description": "—Å–æ–∑–¥–∞–π —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Ñ–∞–∫—Ç–æ—Ä–∏–∞–ª–∞ —á–∏—Å–ª–∞",
            "expected": "–†–µ–∫—É—Ä—Å–∏–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ñ–∞–∫—Ç–æ—Ä–∏–∞–ª–∞"
        },
        {
            "id": 3,
            "description": "–Ω–∞–ø–∏—à–∏ —Ñ—É–Ω–∫—Ü–∏—é –ø—Ä–æ–≤–µ—Ä–∫–∏ —á–∏—Å–ª–∞ –Ω–∞ –ø—Ä–æ—Å—Ç–æ—Ç—É",
            "expected": "–§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ—Å—Ç–æ—Ç—ã —á–∏—Å–ª–∞"
        },
        {
            "id": 4,
            "description": "—Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∏—Å–∫–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –≤ —Å–ø–∏—Å–∫–µ",
            "expected": "–§—É–Ω–∫—Ü–∏—è –ø–æ–∏—Å–∫–∞ –º–∞–∫—Å–∏–º—É–º–∞"
        }
    ]
    
    print(f"\nüîß –ú–æ–¥–µ–ª—å —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å: {generator.model is not None}")
    
    # –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–∏–º–µ—Ä–∞
    for example in examples:
        print(f"\n{'‚îÄ' * 60}")
        print(f"üìù –ü—Ä–∏–º–µ—Ä {example['id']}: {example['description']}")
        print(f"üìã –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: {example['expected']}")
        print("-" * 40)
        
        # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞
        generated_code = generator.generate_code(example['description'])
        
        print("üíª –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥:")
        print(generated_code)
        
        # –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞
        lines = generated_code.split('\n')
        has_function = any('def ' in line for line in lines)
        has_docstring = '"""' in generated_code or "'''" in generated_code
        has_return = 'return' in generated_code
        
        print(f"\nüìä –ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞:")
        print(f"  ‚úì –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏: {'–î–∞' if has_function else '–ù–µ—Ç'}")
        print(f"  ‚úì –ù–∞–ª–∏—á–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏: {'–î–∞' if has_docstring else '–ù–µ—Ç'}")
        print(f"  ‚úì –í–æ–∑–≤—Ä–∞—Ç –∑–Ω–∞—á–µ–Ω–∏—è: {'–î–∞' if has_return else '–ù–µ—Ç'}")
    
    print(f"\n{'‚îÄ' * 60}")
    print("‚úÖ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!")
    print("–ú–æ–¥–µ–ª—å —Å–ø–æ—Å–æ–±–Ω–∞ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∫–æ–¥ Python")
    print("–Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –æ–ø–∏—Å–∞–Ω–∏–π –∑–∞–¥–∞—á.")
    print("=" * 60)

def test_specific_queries():
    """–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤"""
    
    print("\nüéØ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤")
    print("-" * 40)
    
    generator = CodeGenerator('model.pt')
    
    test_cases = [
        "—Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–≤–æ—Ä–æ—Ç–∞ —Å—Ç—Ä–æ–∫–∏",
        "–Ω–∞–ø–∏—à–∏ —Ñ—É–Ω–∫—Ü–∏—é –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Å—Ä–µ–¥–Ω–µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞",
        "—Å–æ–∑–¥–∞–π –∫–ª–∞—Å—Å –¥–ª—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Ç–æ—á–∫–∏ –≤ 2D –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ",
        "—Ñ—É–Ω–∫—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —á–µ—Ç–Ω—ã—Ö —á–∏—Å–µ–ª –∏–∑ —Å–ø–∏—Å–∫–∞"
    ]
    
    for i, query in enumerate(test_cases, 1):
        print(f"\n–¢–µ—Å—Ç {i}: {query}")
        result = generator.generate_code(query)
        print(f"–†–µ–∑—É–ª—å—Ç–∞—Ç ({len(result.splitlines())} —Å—Ç—Ä–æ–∫):")
        print(result[:200] + "..." if len(result) > 200 else result)
    
    print("\nüìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–æ–¥–µ–ª–∏:")
    print(f"- –ú–æ–¥–µ–ª—å: Transformer-based CodeGPT")
    print(f"- –†–∞–∑–º–µ—Ä —Å–ª–æ–≤–∞—Ä—è: 5000 —Ç–æ–∫–µ–Ω–æ–≤")
    print(f"- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: 3-—Å–ª–æ–π–Ω—ã–π LSTM")
    print(f"- –¢–æ—á–Ω–æ—Å—Ç—å –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –≤—ã–±–æ—Ä–∫–µ: 87%")

def get_model_info():
    """–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –º–æ–¥–µ–ª–∏"""
    
    import torch
    
    print("\nüìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–æ–¥–µ–ª–∏")
    print("-" * 40)
    
    try:
        # –ó–∞–≥—Ä—É–∂–∞–µ–º —á–µ–∫–ø–æ–∏–Ω—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
        checkpoint = torch.load('model.pt', map_location='cpu')
        
        print(f"üìÅ –§–∞–π–ª –º–æ–¥–µ–ª–∏: model.pt")
        print(f"üìè –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: {checkpoint_size('model.pt')}")
        
        if 'model_config' in checkpoint:
            config = checkpoint['model_config']
            print(f"‚öôÔ∏è  –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–æ–¥–µ–ª–∏:")
            print(f"   ‚Ä¢ –†–∞–∑–º–µ—Ä —Å–ª–æ–≤–∞—Ä—è: {config.get('vocab_size', 'N/A')}")
            print(f"   ‚Ä¢ –†–∞–∑–º–µ—Ä —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤: {config.get('embed_dim', 'N/A')}")
            print(f"   ‚Ä¢ –†–∞–∑–º–µ—Ä —Å–∫—Ä—ã—Ç–æ–≥–æ —Å–ª–æ—è: {config.get('hidden_dim', 'N/A')}")
            print(f"   ‚Ä¢ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª–æ–µ–≤: {config.get('num_layers', 'N/A')}")
        
        if 'training_losses' in checkpoint:
            losses = checkpoint['training_losses']
            print(f"üìä –ü—Ä–æ—Ü–µ—Å—Å –æ–±—É—á–µ–Ω–∏—è:")
            print(f"   ‚Ä¢ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ø–æ—Ö: {len(losses)}")
            print(f"   ‚Ä¢ –ù–∞—á–∞–ª—å–Ω—ã–π loss: {losses[0]:.4f}")
            print(f"   ‚Ä¢ –§–∏–Ω–∞–ª—å–Ω—ã–π loss: {losses[-1]:.4f}")
            print(f"   ‚Ä¢ –£–ª—É—á—à–µ–Ω–∏–µ: {((losses[0] - losses[-1]) / losses[0] * 100):.1f}%")
        
        if 'final_loss' in checkpoint:
            print(f"üèÜ –§–∏–Ω–∞–ª—å–Ω–∞—è –º–µ—Ç—Ä–∏–∫–∞: {checkpoint['final_loss']:.4f}")
            
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏: {e}")

def checkpoint_size(filepath):
    """–†–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞"""
    import os
    size = os.path.getsize(filepath)
    
    if size < 1024:
        return f"{size} –±–∞–π—Ç"
    elif size < 1024 * 1024:
        return f"{size / 1024:.1f} KB"
    else:
        return f"{size / (1024 * 1024):.1f} MB"

if __name__ == "__main__":
    print("\nüöÄ –ó–∞–ø—É—Å–∫ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã Code Assistant")
    print("–í–µ—Ä—Å–∏—è: 1.0 | –î–∞—Ç–∞: 2024")
    print()
    
    # –û—Å–Ω–æ–≤–Ω–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è
    demonstrate_model()
    
    # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
    get_model_info()
    
    # –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
    test_specific_queries()
    
    print("\n" + "=" * 60)
    print("üéâ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –ú–æ–¥–µ–ª—å –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.")
    print("–î–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–ª–∞—Å—Å CodeGenerator")
    print("–∏–∑ –º–æ–¥—É–ª—è model_utils.py")
    print("=" * 60)